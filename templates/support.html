{% extends 'base.html' %} {% load static %} {% block content %}
<section class="map">
  <div id="map"></div>
</section>
<!-- <script src="{% static 'js/map.js' %}" defer></script> -->

<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDLv6foLba6R_4ZlNosCqsZft_U8ruFEE&callback=initMap"
  aysnc
  defer
></script>
<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 0,
                lng: 0
            },
            zoom: 10
        });



        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function (position) {
                    var userLatLng = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    map.setCenter(userLatLng);
                },
                function () {
                    handleLocationError(true, map.getCenter());
                }
            );
        } else {
            handleLocationError(false, map.getCenter());
        }

        function handleLocationError(browserHasGeolocation, pos) {
            var infoWindow = new google.maps.InfoWindow();
            infoWindow.setPosition(pos);
            infoWindow.setContent(
                browserHasGeolocation
                    ? 'Error: The Geolocation service failed.'
                    : 'Error: Your browser doesn\'t support geolocation.'
            );
            infoWindow.open(map);
        }

        var locations = [
      {% for location in locations %}
      {
          "name": "{{ location.name }}",
          "lat": {{ location.latitude }},
          "lng": {{ location.longitude }},
          "contact_number": "{{ location.contact_number }}",
          "contact_email": "{{ location.contact_email }}",
      },
      {% endfor %}
  ];

  // console.log('mapLocations:', mapLocations);


        for (var i = 0; i < locations.length; i++) {
            createMarker(locations[i]);
        }

        function createMarker(location) {
            var marker = new google.maps.Marker({
                position: {
                    lat: location.lat,
                    lng: location.lng
                },
                map: map,
                title: location.name
            });

            var infowindow = new google.maps.InfoWindow({
                content: `<div>
                    <h2>${location.name}</h2>
                    <p>Tel: ${location.contact_number}</p>
                    <p>Email: ${location.contact_email}</p>
                </div>`
            });

            marker.addListener('click', function () {
                infowindow.open(map, marker);
            });
        }
    }
</script>

{% endblock %}
